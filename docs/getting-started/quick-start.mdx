---
sidebar_position: 2
---

import Button from '@site/src/components/Button';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Quick start

The Invoice-Collector API is organized around REST. Our API has predictable resource-oriented URLs, accepts JSON-encoded request bodies, returns JSON-encoded responses, and uses standard HTTP response codes, authentication, and verbs.

The server base url is:

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```
    https://api.invoice-collector.com/api/v1
    ```
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```
    http://localhost:8080/api/v1
    ```
  </TabItem>
</Tabs>

In this documentation, the following terms are used:

- **Customer**: Refers to the company which has a contract with Invoice-Collector.
- **User**: Refers to the individual users of Invoice-Collector.

## Authentication

#### Bearer Token Authentication

This authentication method is reserved for customer endpoints only. It involves sending the token in the Authorization header of the HTTP request.

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl -H "Authorization: Bearer <bearer_token>" https://api.invoice-collector.com/api/v1/example
    ```

    You can create a new bearer token anytime by going to the Settings page on the online app.

    <div style={{ textAlign: 'center' }}>
      <Button label="Create a new bearer token" link="https://app.invoice-collector.com/settings" />
    </div>
    <br/>
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl -H "Authorization: Bearer <bearer_token>" http://localhost:8080/api/v1/example
    ```

    Yon can retrieve the default user bearer token from the container logs, first run:

    ```bash
    ...
    Default customer created. Bearer is "<bearer_token>". Keep it safe, it will not be displayed again.
    ...
    ```
  </TabItem>
</Tabs>

:::warning
Be aware that we do not have access to your bearer token and it must be keeped safe. **This token has an unlimited expiry duration.**
:::

#### User token

This authentication method is reserved for user endpoints only. It involves appending the token as a query parameter in the URL.
We will see below how to get this token.

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl https://api.invoice-collector.com/api/v1/example?token=<token>
    ```
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl http://localhost:8080/api/v1/example?token=<token>
    ```
  </TabItem>
</Tabs>

## First request

We will start with a simple request to the endpoint `/customer` to retrieve your informations:

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl -H "Authorization: Bearer <bearer_token>" https://api.invoice-collector.com/api/v1/customer
    ```

    Json body response:

    ```json
    {
      "name": "Awesome Company Name",
      "callback": "https://path.to/callback"
    }
    ```

    This is the `callback` at which invoices will be sent. You can update the callback on the [Settings page](https://app.invoice-collector.com/settings).
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl -H "Authorization: Bearer <bearer_token>" http://localhost:8080/api/v1/customer
    ```

    Json body response:

    ```json
    {
      "name": "default",
      "callback": "https://path.to/callback"
    }
    ```

    This is the `callback` at which invoices will be sent. Make a POST request to the [`/customer` endpoint](../api.mdx#tag/Customer/paths/~1customer/post) to update your informations by your own.
  </TabItem>
</Tabs>

## Create a user & Generate a user token

When a user on your system requests to manage collectors, you need to generate a temporary token to authorize him access to Invoice-Collector server.
You can make a POST request to the `/user` endpoint to create it in our database and generate the token.
If a user with this `remote_id` already exist, it will not create it.

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl -X POST https://api.invoice-collector.com/api/v1/user \
        -H "Authorization: Bearer <bearer_token>" \
        -H "Content-Type: application/json" \
        -d '{
            "remote_id": "A1B2C3D4",
            "locale": "fr"
        }'
    ```

    You can also create a user from the [Users page](https://app.invoice-collector.com/users).
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl -X POST http://localhost:8080/api/v1/user \
        -H "Authorization: Bearer <bearer_token>" \
        -H "Content-Type: application/json" \
        -d '{
            "remote_id": "A1B2C3D4",
            "locale": "fr"
        }'
    ```
  </TabItem>
</Tabs>

- `locale` is the language of the user. Only `fr` and `en` are currently available.
- `remote_id` is used to identify the user on your system. All invoices sent to your `callback` will contain the `remote_id` allong with it so you can identify the user to whom the invoice belongs.

Json body response:

```json
{
  ...
  "token": "fca8a33006220b69dfc922596e77ffe1c2fe5d9f89664fe78f305ac836927fe52a788208d2f881fb829141eac12d2c384468d5e6a89c92dbe40f64a1366d2f22"
}
```

This user `token` has an expiry duration of 30 minutes and can be used to add collectors.

## Add credentials

Once you have the user token, you must redirect the user to the following endpoint to be rendered **in a browser or an iframe**:

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    [`https://api.invoice-collector.com/api/v1/ui?token=<token>`](https://api.invoice-collector.com/api/v1/ui?token=REPLACE_ME)
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    [`http://localhost:8080/api/v1/ui?token=<token>`](http://localhost:8080/api/v1/ui?token=REPLACE_ME)
  </TabItem>
</Tabs>

From there, the user can add new credential.
Only the new invoices will be sent to the `callback` endpoint allong with the `remote_id`.

And that is it ðŸŽ‰ New invoices will be sent to your callback!

If like us, you have no time to waste, you can [test the callback in the next section](#test-callback).

## Test Callback

If you do not want to wait, you can directly ask the server to send a fake invoice to your callback:

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl -X GET https://api.invoice-collector.com/api/v1/test_callback \
        -H "Authorization: Bearer <bearer_token>"
    ```
    
    You can also send a fake invoice from the [Settings page](https://app.invoice-collector.com/settings).
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl -X GET http://localhost:8080/api/v1/test_callback \
        -H "Authorization: Bearer <bearer_token>"
    ```
  </TabItem>
</Tabs>

Checkout your callback, you must have received a fake invoice!
See the [API Reference for the callback schema](../api.mdx#/paths/~1test~1callback~1{type}/get).

## List credentials

At some point, you may want to list all the credentials for a given user:

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl -X GET https://api.invoice-collector.com/api/v1/user/{user_id}/credentials \
        -H "Authorization: Bearer <bearer_token>"
    ```
    
    You can also list the credentials from the [Users page](https://app.invoice-collector.com/users).
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl -X GET http://localhost:8080/api/v1/user/{user_id}/credentials \
        -H "Authorization: Bearer <bearer_token>"
    ```
  </TabItem>
</Tabs>

## Remove a credential

If you want to remove a credential and therefore stop invoice collection you can use:

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl -X DELETE https://api.invoice-collector.com/api/v1/user/{user_id}/credential/{credential_id} \
        -H "Authorization: Bearer <bearer_token>"
    ```
    
    You can also remove a  credentials from the [Users page](https://app.invoice-collector.com/users).
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl -X DELETE http://localhost:8080/api/v1/user/{user_id}}/credential/{credential_id} \
        -H "Authorization: Bearer <bearer_token>"
    ```
  </TabItem>
</Tabs>

## Remove a user

If a user does no longer needs automatic invoice collection, it can be removed:

<Tabs groupId="server-base-url">
  <TabItem value="cloud" label="Cloud" default>
    ```bash
    curl -X DELETE https://api.invoice-collector.com/api/v1/user \
        -H "Authorization: Bearer <bearer_token>" \
        -H "Content-Type: application/json" \
        -d '{
            "remote_id": "A1B2C3D4"
        }'
    ```

    You can also remove a user from the [Users page](https://app.invoice-collector.com/users).
  </TabItem>
  <TabItem value="self-hosted" label="Self-Hosted">
    ```bash
    curl -X DELETE http://localhost:8080/api/v1/user \
        -H "Authorization: Bearer <bearer_token>" \
        -H "Content-Type: application/json" \
        -d '{
            "remote_id": "A1B2C3D4"
        }'
    ```
  </TabItem>
</Tabs>

All the credentials, collectors and user informations will be removed from the database.

:::note
- Using the builtin UI is not mandatory. Developers can create there own one to better fit your needs and design rules.
- Please refer to the [API Reference](../api.mdx) for more advanced requests.
:::